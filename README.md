#### 基于MQTT的聊天室

##### 功能：

- 注册
- 登录，可选择进入哪个群组
- 发送文字、图片，消息会一直保存着
- 退出

##### 详细描述：

- 注册功能，用户名、密码和服务暗号
- 登录，用户名、密码、进入群组，登录之后，服务器应该生成一个用用户名为key的token存入redis，有过期时间，将token发给用户
- 发送文字、图片，每次进入那个群组，能看到所有历史数据





##### mysql数据库设计

- 用户表 user

|   参数   |    类型     | 是否必须 |   含义   |
| :------: | :---------: | :------: | :------: |
|    id    |     int     |    是    | 唯一标识 |
|   name   | varchar(20) |    是    |  用户名  |
| password | varchar(20) |    是    |   密码   |

- 聊天室 chat_rooms

| 参数 |    类型     | 是否必须 |   含义   |
| :--: | :---------: | :------: | :------: |
|  id  |     int     |    是    | 唯一标识 |
| name | varchar(20) |    是    |  用户名  |

- 聊天记录 chat_notes

|    参数     |     类型      | 是否必须 |      含义      |
| :---------: | :-----------: | :------: | :------------: |
|     id      |      int      |    是    |    唯一标识    |
|   room_id   |      int      |    是    | 聊天室唯一标识 |
|   user_id   |      int      |    是    |  用户唯一标识  |
|   message   | varchar(1024) |    否    |    聊天信息    |
| picture_url | varchar(128)  |    否    |    图片链接    |
|    time     |  varchar(20)  |    是    |    发布时间    |

注：message和picture_url字段两者必须有且只能出现一个



##### redis数据库设计

- 用户登录状态，以用户名为key，ip地址为value进行有效期限存储
- mqtt获取的数据，以队列存储在redis中，也就是说，开启两个进程，一个是mqtt的Broker，一个是一直循环从redis队列中获取。服务器上的mqtt会监听以聊天室id或者名字为topic的消息，客户端是发送。